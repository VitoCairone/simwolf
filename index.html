<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SimWolf Isometric Grid</title>
  <style>
    * {
      margin: 0;
      padding: 0;
    }

    body, html {
      height: 100%;
      overflow: hidden;
      font-family: sans-serif;
    }

    #app {
      display: flex;
      height: 100%;
    }

    #sidebar {
      width: 120px;
      background: #333;
      color: white;
      display: flex;
      flex-direction: column;
      padding: 10px;
    }

    #field-wrapper {
      flex: 1;
      position: relative;
      overflow: hidden;
      background-color: #9dd4f3;
    }

    #field {
      position: absolute;
      top: 0;
      left: 0;
      width: 3000px;
      height: 3000px;
      will-change: transform;
      transform: translate(0, 0);
    }

    .tile {
      position: absolute;
      width: 32px;
      height: 32px;
      background-image: url('./images_raw/tiles.png');
      background-repeat: no-repeat;
      background-size: auto;
      image-rendering: pixelated;
      overflow: visible;
    }
  </style>
</head>
<body>
  <div id="app">
    <div id="sidebar">
      <button>Tool 1</button>
      <button>Tool 2</button>
    </div>
    <div id="field-wrapper">
      <div id="field"></div>
    </div>
  </div>

  <script>
    const field = document.getElementById("field");
    const tileSize = 32;
    const gridWidth = 128;
    const gridHeight = 128;

    const SPRITE_WIDTH = 32;
    const SPRITE_HEIGHT = 32;
    const SPRITE_ROWS = 4; //7;
    const SPRITE_COLS = 11;

    for (let y = 0; y < gridHeight; y++) {
      for (let x = 0; x < gridWidth; x++) {
        const tile = document.createElement("div");
        tile.classList.add("tile");

        const isoX = (x - y) * (tileSize / 2);// + 1500;
        const isoY = (x + y) * (tileSize / 4);

        tile.style.left = isoX + "px";
        tile.style.top = isoY + "px";
        tile.style.zIndex = x + y;

        // Choose random sprite
        const spriteI = Math.floor(Math.random() * SPRITE_COLS);
        const spriteJ = Math.floor(Math.random() * SPRITE_ROWS);
        console.log(spriteI, spriteJ);

        tile.style.backgroundPosition = `-${spriteI * SPRITE_WIDTH}px -${spriteJ * SPRITE_HEIGHT}px`;

        field.appendChild(tile);
      }
    }

    let cameraX = 0;
    let cameraY = 0;
    const speed = 10;
    const keysPressed = {};

    function updateCamera() {
      field.style.transform = `translate(${-cameraX}px, ${-cameraY}px)`;
    }

    function cameraHasRoom(direction) {
      switch (direction) {
        case 'up':
          return cameraY >= -1000;
        case 'down':
          return cameraY <= 1000; // cameraY <= maxCameraY;
        case 'left':
          return cameraX >= -1000;
        case 'right':
          return cameraX <= 1000;
        default:
          console.log('cameraHasRoom invalid input');
          return false;
      }
    }

    function gameLoop() {
      if (keysPressed["ArrowUp"] && cameraHasRoom('up')) cameraY -= speed;
      if (keysPressed["ArrowDown"] && cameraHasRoom('down')) cameraY += speed;
      if (keysPressed["ArrowLeft"] && cameraHasRoom('left')) cameraX -= speed;
      if (keysPressed["ArrowRight"] && cameraHasRoom('right')) cameraX += speed;

      updateCamera();
      requestAnimationFrame(gameLoop);
    }

    document.addEventListener("keydown", (e) => {
      keysPressed[e.key] = true;
    });

    document.addEventListener("keyup", (e) => {
      keysPressed[e.key] = false;
    });

    requestAnimationFrame(gameLoop);
  </script>
</body>
</html>